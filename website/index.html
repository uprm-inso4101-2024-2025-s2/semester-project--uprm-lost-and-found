<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UPRM Lost and Found</title>
  <link rel="stylesheet" href="cssfiles/styles.css">
</head>
<body>
  <div class="wrapper">
    <header>
      <h1>UPRM Lost and Found</h1>
      <nav>
        <ul>
          <li><a href="report-type.html">Make Report</a></li>
          <li><a href="my_cases.html">Your Cases</a></li>
          <li><a href="#">Our Location</a></li>
          <li><a href="#">Contact Us</a></li>
          <li><a href="signup.html">Sign Up</a></li>
          <li><a href="login.html">Log In</a></li>
        </ul>
      </nav>
    </header>

    <main>
      <section id="about-mission">
        <div id="about" class="block">
          <h2>About Us</h2>
          <p>Welcome to the UPRM Lost and Found...</p>
        </div>
        <div id="mission" class="block">
          <h2>Our Mission</h2>
          <p>At UPRM Lost and Found...</p>
        </div>
      </section>

      <section id="recently-lost">
        <h2>Recently Lost</h2>
        <div class="photo-grid" id="lost-items-container"></div>
      </section>
    </main>

    <footer>
      <div class="footer-columns">
        <div class="footer-column">
          <h3>Contact Us</h3>
          <p>Email: <a href="mailto:lostandfound@upr.edu">lostandfound@upr.edu</a></p>
          <p>Phone: +1 (787) 123-4567</p>
        </div>
        <div class="footer-column">
          <h3>Follow Us</h3>
          <p><a href="https://twitter.com/uprmlostfound" target="_blank">Twitter</a></p>
          <p><a href="https://instagram.com/uprmlostfound" target="_blank">Instagram</a></p>
        </div>
        <div class="footer-column">
          <h3>Location</h3>
          <p>University of Puerto Rico, Mayagüez</p>
          <p>Student Center, Room 101</p>
          <p>Mayagüez, PR 00681</p>
        </div>
      </div>
      <p class="footer-copyright">
        &copy; 2025 UPRM Lost and Found. All rights reserved.
      </p>
    </footer>
  </div>

  <div id="itemModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 w-11/12 max-w-md relative">
      <button id="closeModal" class="absolute top-2 right-3 text-gray-500 hover:text-red-500 text-xl">&times;</button>
      <input id="editTitle" class="text-lg font-bold mb-2 w-full border rounded px-2 py-1 hidden">
      <h3 id="modalTitle" class="text-lg font-bold mb-2"></h3>
      <img id="modalImage" src="" alt="Item Image" class="w-full h-48 object-cover mb-4 rounded">
      <textarea id="editInfo" class="w-full border rounded px-2 py-1 text-sm hidden"></textarea>
      <p id="modalInfo" class="text-sm text-gray-700 mb-2"></p>
      <p id="modalDate" class="text-xs text-gray-500 mb-4"></p>
      <div class="flex justify-between mt-4">
        <button id="claimBtn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Claim Item</button>
        <div class="space-x-2">
          <button id="editBtn" class="bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600">Edit</button>
          <button id="deleteBtn" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentItem = null;

    window.addEventListener("DOMContentLoaded", () => {
      fetch("http://localhost:8000/api/lost-items/")
        .then(res => res.json())
        .then(items => {
          const container = document.getElementById("lost-items-container");
          container.innerHTML = "";

          items.forEach(item => {
            const div = document.createElement("div");
            div.className = "photo-item";

            const image = document.createElement("img");
            image.src = item.photo_urls[0] || "images/placeholder.jpg";
            image.alt = "Lost Item";

            const desc = document.createElement("p");
            desc.textContent = item.description;

            const btn = document.createElement("button");
            btn.textContent = "View Details";
            btn.className = "mt-2 px-3 py-1 bg-green-600 text-white text-sm rounded hover:bg-green-700";
            btn.onclick = () => showModal(item);

            div.appendChild(image);
            div.appendChild(desc);
            div.appendChild(btn);
            container.appendChild(div);
          });
        });
    });

    function showModal(item) {
      currentItem = item;
      window.selectedItemId = item.id;

      document.getElementById("modalTitle").textContent = item.description;
      document.getElementById("modalImage").src = item.photo_urls[0] || "images/placeholder.jpg";
      document.getElementById("modalInfo").textContent = item.information;
      document.getElementById("modalDate").textContent = "Published: " + item.publish_date;

      document.getElementById("editTitle").value = item.description;
      document.getElementById("editInfo").value = item.information;

      document.getElementById("itemModal").classList.remove("hidden");
    }

    document.getElementById("closeModal").addEventListener("click", () => {
      document.getElementById("itemModal").classList.add("hidden");
      resetModal();
    });

    document.getElementById("deleteBtn").onclick = () => {
      const id = window.selectedItemId;
      fetch(`http://localhost:8000/api/lost-items/${id}`, { method: "DELETE" })
        .then(() => location.reload());
    };

    document.getElementById("editBtn").onclick = () => {
      const title = document.getElementById("modalTitle");
      const info = document.getElementById("modalInfo");
      const editTitle = document.getElementById("editTitle");
      const editInfo = document.getElementById("editInfo");

      if (editTitle.classList.contains("hidden")) {
        title.classList.add("hidden");
        info.classList.add("hidden");
        editTitle.classList.remove("hidden");
        editInfo.classList.remove("hidden");
        document.getElementById("editBtn").textContent = "Save Changes";
      } else {
        const updated = {
          description: editTitle.value,
          information: editInfo.value,
          images: currentItem.photo_urls,
          publish_date: currentItem.publish_date
        };

        fetch(`http://localhost:8000/api/lost-items/${currentItem.id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(updated)
        })
        .then(() => location.reload());
      }
    };

    function resetModal() {
      document.getElementById("modalTitle").classList.remove("hidden");
      document.getElementById("modalInfo").classList.remove("hidden");
      document.getElementById("editTitle").classList.add("hidden");
      document.getElementById("editInfo").classList.add("hidden");
      document.getElementById("editBtn").textContent = "Edit";
    }
  </script>
</body>
</html>
